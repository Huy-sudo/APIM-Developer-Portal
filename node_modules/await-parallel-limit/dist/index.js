"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const parallel = (jobs, limit) => __awaiter(this, void 0, void 0, function* () {
    if (!Array.isArray(jobs)) {
        throw new Error('First argument is not an array.');
    }
    var n = Math.min(limit || 5, jobs.length);
    var ret = [];
    var index = 0;
    var next = () => __awaiter(this, void 0, void 0, function* () {
        var i = index++;
        var job = jobs[i];
        ret[i] = yield job();
        if (index < jobs.length)
            yield next();
    });
    var next_arr = Array(n).fill(next);
    yield Promise.all(next_arr.map((f) => { return f(); }));
    return ret;
});
exports.default = parallel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUtBLE1BQU0sUUFBUSxHQUFHLENBQ2YsSUFBK0MsRUFDL0MsS0FBWSxFQUNaLEVBQUU7SUFJRixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUN4QixNQUFNLElBQUksS0FBSyxDQUFDLGlDQUFpQyxDQUFDLENBQUE7S0FDbkQ7SUFFRCxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQ3pDLElBQUksR0FBRyxHQUFPLEVBQUUsQ0FBQTtJQUNoQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUE7SUFFYixJQUFJLElBQUksR0FBRyxHQUFTLEVBQUU7UUFDcEIsSUFBSSxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUE7UUFDZixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDakIsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sR0FBRyxFQUFFLENBQUE7UUFDcEIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU07WUFBRSxNQUFNLElBQUksRUFBRSxDQUFBO0lBQ3ZDLENBQUMsQ0FBQSxDQUFBO0lBRUQsSUFBSSxRQUFRLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNsQyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFFdEQsT0FBMEIsR0FBRyxDQUFBO0FBQy9CLENBQUMsQ0FBQSxDQUFBO0FBRUQsa0JBQWUsUUFBUSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsidHlwZSBVbnBhY2tlZDxUPiA9XG4gICAgVCBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gaW5mZXIgVSA/IFUgOlxuICAgIFQgZXh0ZW5kcyBQcm9taXNlPGluZmVyIFU+ID8gVSA6XG4gICAgVDtcblxuY29uc3QgcGFyYWxsZWwgPSBhc3luYyA8VD4oXG4gIGpvYnM6IHsgW0sgaW4ga2V5b2YgVF06ICgoKSA9PiBQcm9taXNlPFRbS10+KSB9LFxuICBsaW1pdDpudW1iZXIsXG4pID0+IHtcbiAgdHlwZSBEYXRhID0gdHlwZW9mIGpvYnNcbiAgdHlwZSBNYXBUb1Jlc3VsdDxYIGV4dGVuZHMgRGF0YT4gPSB7IFtLIGluIGtleW9mIFhdOiBVbnBhY2tlZDxVbnBhY2tlZDxYW0tdPj4gfVxuXG4gIGlmICghQXJyYXkuaXNBcnJheShqb2JzKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignRmlyc3QgYXJndW1lbnQgaXMgbm90IGFuIGFycmF5LicpIFxuICB9XG5cbiAgdmFyIG4gPSBNYXRoLm1pbihsaW1pdCB8fCA1LCBqb2JzLmxlbmd0aClcbiAgdmFyIHJldDphbnkgPSBbXVxuICB2YXIgaW5kZXggPSAwXG5cbiAgdmFyIG5leHQgPSBhc3luYyAoKSA9PiB7XG4gICAgdmFyIGkgPSBpbmRleCsrXG4gICAgdmFyIGpvYiA9IGpvYnNbaV1cbiAgICByZXRbaV0gPSBhd2FpdCBqb2IoKVxuICAgIGlmIChpbmRleCA8IGpvYnMubGVuZ3RoKSBhd2FpdCBuZXh0KClcbiAgfVxuXG4gIHZhciBuZXh0X2FyciA9IEFycmF5KG4pLmZpbGwobmV4dClcbiAgYXdhaXQgUHJvbWlzZS5hbGwobmV4dF9hcnIubWFwKChmKSA9PiB7IHJldHVybiBmKCkgfSkpXG5cbiAgcmV0dXJuIDxNYXBUb1Jlc3VsdDxEYXRhPj5yZXRcbn1cblxuZXhwb3J0IGRlZmF1bHQgcGFyYWxsZWwiXX0=